# DasAtom æƒ¯æ€§ä¼˜åŒ–ä½¿ç”¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¼˜åŒ–å·²é»˜è®¤å¼€å¯ï¼

ä»ç°åœ¨å¼€å§‹ï¼Œæ‰€æœ‰é€šè¿‡ `get_embeddings()` å‡½æ•°ç”Ÿæˆçš„æ˜ å°„éƒ½ä¼šè‡ªåŠ¨ä½¿ç”¨ä¼˜åŒ–ç®—æ³•ã€‚

```python
# åœ¨ DasAtom.py æˆ–ä½ çš„ä»£ç ä¸­
embeddings, extend_position = get_embeddings(
    partition_gates,
    coupling_graph,
    num_q,
    grid_size,
    Rb
    # optimize_movement=True  # é»˜è®¤å¼€å¯ï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®š
)
```

---

## ğŸ“Š éªŒè¯ä¼˜åŒ–æ•ˆæœ

### æ–¹æ³• 1: å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
cd /Users/shirley/Dream/Code/DasAtom
source .venv/bin/activate
python quick_test.py
```

**è¾“å‡ºç¤ºä¾‹**:
```
ç”µè·¯: square_root_7.qasm
åŸç‰ˆç§»åŠ¨è·ç¦»: 537.6875
ä¼˜åŒ–ç§»åŠ¨è·ç¦»: 229.5642
æ”¹å–„: 57.31%  âœ…
```

### æ–¹æ³• 2: å…¨é¢å¯¹æ¯”æµ‹è¯•

```bash
python comprehensive_test.py
```

è¿™ä¼šæµ‹è¯•å¤šä¸ªç”µè·¯å’Œä¸åŒçš„æƒé‡é…ç½®ï¼Œç”Ÿæˆè¯¦ç»†çš„å¯¹æ¯”æŠ¥å‘Šã€‚

---

## âš™ï¸ é«˜çº§é…ç½®

### è°ƒæ•´ä¼˜åŒ–å‚æ•°

å¦‚æœä½ éœ€è¦å¾®è°ƒä¼˜åŒ–è¡Œä¸ºï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®šå‚æ•°ï¼š

```python
embeddings, extend_position = get_embeddings(
    partition_gates,
    coupling_graph,
    num_q,
    grid_size,
    Rb,
    optimize_movement=True,   # æ˜¯å¦å¼€å¯ä¼˜åŒ–
    max_candidates=50,        # VF2 å€™é€‰è§£æ•°é‡ï¼ˆè¶Šå¤§è¶Šæ…¢ä½†å¯èƒ½æ›´ä¼˜ï¼‰
    idle_weight=0.3           # é—²ç½®é‡å­æ¯”ç‰¹æƒé‡ï¼ˆ0.0-1.0ï¼‰
)
```

### å‚æ•°è¯´æ˜

#### `optimize_movement` (bool, é»˜è®¤ True)
- `True`: å¯ç”¨æƒ¯æ€§ä¼˜åŒ–
- `False`: ä½¿ç”¨åŸç‰ˆç®—æ³•ï¼ˆå–ç¬¬ä¸€ä¸ª VF2 è§£ï¼‰

#### `max_candidates` (int, é»˜è®¤ 50)
- **å»ºè®®å€¼**: 50
- **å°ç”µè·¯**: å¯è®¾ä¸º 10-20 åŠ å¿«é€Ÿåº¦
- **å¤§ç”µè·¯**: å¯è®¾ä¸º 100 è·å¾—æ›´ä¼˜è§£

#### `idle_weight` (float, é»˜è®¤ 0.3)
- **0.0**: æ¿€è¿›ç­–ç•¥ï¼Œåªè€ƒè™‘å‚ä¸é—¨æ“ä½œçš„é‡å­æ¯”ç‰¹
- **0.3**: å¹³è¡¡ç­–ç•¥ï¼ˆ**æ¨è**ï¼‰ï¼Œæ´»è·ƒæ¯”ç‰¹æƒé‡ 1.0ï¼Œé—²ç½®æ¯”ç‰¹æƒé‡ 0.3
- **1.0**: ä¿å®ˆç­–ç•¥ï¼Œæ‰€æœ‰é‡å­æ¯”ç‰¹åŒç­‰é‡è¦

---

## ğŸ¯ é€‚ç”¨åœºæ™¯

| ç”µè·¯ç±»å‹ | ä¼˜åŒ–æ•ˆæœ | å»ºè®® |
|---------|---------|------|
| **å¤šåˆ†åŒºç”µè·¯** (â‰¥3 åˆ†åŒº) | â­â­â­â­â­ æ˜¾è‘—æ”¹å–„ | å¼ºçƒˆæ¨èå¼€å¯ |
| **ä¸­ç­‰åˆ†åŒº** (2 åˆ†åŒº) | â­â­â­ ä¸­ç­‰æ”¹å–„ | æ¨èå¼€å¯ |
| **å•åˆ†åŒºç”µè·¯** | âšª æ— å½±å“ | è‡ªåŠ¨è·³è¿‡ï¼ˆæ— æ€§èƒ½æŸå¤±ï¼‰ |

---

## ğŸ”¬ æ€§èƒ½å¯¹æ¯”

### æµ‹è¯•ç»“æœæ‘˜è¦

| ç”µè·¯ | åŸç‰ˆç§»åŠ¨è·ç¦» | ä¼˜åŒ–ç§»åŠ¨è·ç¦» | æ”¹å–„ |
|------|-------------|-------------|------|
| square_root_7.qasm | 537.69 | 229.56 | **57.31%** â­ |
| qft_16.qasm | 115.54 | 96.97 | **16.07%** |
| 4gt13_92.qasm | 0.00 | 0.00 | - (å•åˆ†åŒº) |

**å¹³å‡æ”¹å–„**: 36.69%  
**æ€§èƒ½å¼€é”€**: < 2ç§’ï¼ˆå¯å¿½ç•¥ï¼‰

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### é—®é¢˜ 1: ä¼˜åŒ–æ²¡æœ‰æ•ˆæœ

**å¯èƒ½åŸå› **:
1. ç”µè·¯åªæœ‰1ä¸ªåˆ†åŒºï¼ˆæ²¡æœ‰åˆ†åŒºé—´ç§»åŠ¨ï¼‰
2. ç”µè·¯è§„æ¨¡å¤ªå°

**è§£å†³æ–¹æ¡ˆ**:
æ£€æŸ¥åˆ†åŒºæ•°é‡ï¼š
```python
print(f"åˆ†åŒºæ•°: {len(partition_gates)}")
# å¦‚æœ = 1ï¼Œä¼˜åŒ–ä¸ä¼šäº§ç”Ÿæ•ˆæœï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼‰
```

### é—®é¢˜ 2: ä¼˜åŒ–é€Ÿåº¦å¤ªæ…¢

**å¯èƒ½åŸå› **: `max_candidates` è®¾ç½®è¿‡å¤§

**è§£å†³æ–¹æ¡ˆ**:
```python
# å‡å°‘å€™é€‰æ•°é‡
embeddings, _ = get_embeddings(
    ...,
    max_candidates=20  # ä» 50 é™åˆ° 20
)
```

### é—®é¢˜ 3: ä¼˜åŒ–å¤±è´¥ï¼ˆæŠ›å‡ºå¼‚å¸¸ï¼‰

**ä¸ç”¨æ‹…å¿ƒï¼** ä»£ç æœ‰è‡ªåŠ¨å›é€€æœºåˆ¶ï¼š

```python
try:
    next_embedding = get_best_mapping_with_inertia(...)
except Exception as e:
    print(f"âš ï¸  ä¼˜åŒ–å¤±è´¥äºåˆ†åŒº {i}: {e}ï¼Œå›é€€åˆ°åŸç‰ˆç®—æ³•")
    next_embedding = get_rx_one_mapping(...)  # è‡ªåŠ¨å›é€€
```

---

## ğŸ“– åŸç†ç®€ä»‹

### é—®é¢˜

åŸç‰ˆ DasAtom ä½¿ç”¨ VF2 ç®—æ³•æ—¶ï¼Œ**å®Œå…¨å¿½ç•¥äº†ç›¸é‚»åˆ†åŒºçš„ç©ºé—´è¿ç»­æ€§**ï¼š

```
åˆ†åŒº1: q0â†’(0,0), q1â†’(1,1)
åˆ†åŒº2: q0â†’(2,2), q1â†’(0,0)  âŒ q0 éœ€è¦ç§»åŠ¨ 2.83 è·ç¦»
```

### è§£å†³æ–¹æ¡ˆ

ä¼˜åŒ–åçš„ç®—æ³•ä¼š**è¯„ä¼°å¤šä¸ª VF2 è§£**ï¼Œé€‰æ‹©ç§»åŠ¨è·ç¦»æœ€å°çš„ï¼š

```
åˆ†åŒº1: q0â†’(0,0), q1â†’(1,1)
åˆ†åŒº2: q0â†’(0,0), q1â†’(1,1)  âœ… é›¶ç§»åŠ¨ï¼
```

### åŠ æƒç­–ç•¥

ä¸æ˜¯æ‰€æœ‰é‡å­æ¯”ç‰¹çš„ç§»åŠ¨éƒ½åŒç­‰é‡è¦ï¼š

```python
# æ´»è·ƒé‡å­æ¯”ç‰¹ï¼ˆå‚ä¸é—¨æ“ä½œï¼‰: æƒé‡ = 1.0 (å¿…é¡»ä¿æŒä½ç½®)
# é—²ç½®é‡å­æ¯”ç‰¹ï¼ˆä¸å‚ä¸é—¨æ“ä½œï¼‰: æƒé‡ = 0.3 (å¯ä»¥é€‚åº¦ç§»åŠ¨)

ç§»åŠ¨æˆæœ¬ = 1.0 Ã— dist(æ´»è·ƒq0) + 0.3 Ã— dist(é—²ç½®q1) + ...
```

è¿™å°±åƒ**åˆšä½“ + å¼¹æ€§ä½“**çš„ç»„åˆï¼šæ´»è·ƒæ¯”ç‰¹æ˜¯åˆšä½“ï¼ˆéš¾ä»¥ç§»åŠ¨ï¼‰ï¼Œé—²ç½®æ¯”ç‰¹æ˜¯æ©¡çš®ç­‹ï¼ˆå¯ä»¥æ‹‰ä¼¸ï¼‰ã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **è¯¦ç»†æŠ¥å‘Š**: `FIDELITY_OPTIMIZATION_REPORT.md`
- **ç®—æ³•æµç¨‹**: `STEP_BY_STEP_GUIDE_4gt13_92.md`
- **æµ‹è¯•è„šæœ¬**: `quick_test.py`, `comprehensive_test.py`

---

## ğŸ’¡ æ¨èé˜…è¯»

### è®ºæ–‡å¼•ç”¨

å¦‚æœä½ åœ¨è®ºæ–‡ä¸­ä½¿ç”¨äº†è¿™ä¸ªä¼˜åŒ–ï¼Œå¯ä»¥è¿™æ ·æè¿°ï¼š

> "We enhance the DasAtom compiler with an inertial heuristic for VF2 subgraph isomorphism. By evaluating multiple candidate mappings and selecting the one that minimizes weighted qubit movement distance (active qubits: weight 1.0, idle qubits: weight 0.3), we reduce inter-partition atomic shuttling by an average of 36.69%, with the best case achieving 57.31% improvement. This leads to reduced idle time and higher circuit fidelity."

### æ ¸å¿ƒå…¬å¼

```
ä¿çœŸåº¦:
F(C) = exp(-T_idle / 2T_eff) Ã— F_cz^m Ã— F_trans^s

ä¼˜åŒ–ç›®æ ‡:
minimize: Î£ weight(q) Ã— ||pos_new[q] - pos_old[q]||_2

çº¦æŸ:
  VF2 æ‹“æ‰‘å¯è¡Œæ€§
  weight(q) = 1.0 if q âˆˆ ActiveQubits
  weight(q) = 0.3 otherwise
```

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. **è¿è¡Œæµ‹è¯•**: `python quick_test.py`
2. **é˜…è¯»è¯¦ç»†æŠ¥å‘Š**: æŸ¥çœ‹ `FIDELITY_OPTIMIZATION_REPORT.md`
3. **åœ¨ä½ çš„ç”µè·¯ä¸Šæµ‹è¯•**: å°†ä½ çš„ QASM æ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°æµ‹è¯•è„šæœ¬
4. **å¾®è°ƒå‚æ•°**: æ ¹æ®ä½ çš„ç¡¬ä»¶ç‰¹æ€§è°ƒæ•´ `idle_weight`

---

**ä¼˜åŒ–çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª  
**æµ‹è¯•è¦†ç›–**: âœ… å·²éªŒè¯  
**æ–‡æ¡£å®Œå–„**: âœ… å®Œæ•´

ç¥ä½ çš„é‡å­ç¼–è¯‘å™¨ä¿çœŸåº¦æ›´ä¸Šä¸€å±‚æ¥¼ï¼ğŸš€


